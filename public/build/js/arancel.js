!function(){let e=0;const t=document.querySelector("#usuario-solicitante").value,o=document.querySelector("#categoria"),a=document.querySelector("#cantidad ul"),i=document.querySelector("#boton"),n=document.querySelector("#listado-aranceles"),r=document.querySelector(".campo-cedula"),d=document.querySelector("#usuario"),c=document.querySelector("#cedulaBusqueda"),l=document.querySelector("#btn-buscador"),s=document.querySelector("#nacionalidad"),u=document.querySelector("#formulario");function m(e){p[e.target.id]=e.target.value.trim(),Object.values(p.nacionalidad).includes("")||(r.style.display="flex",c.disabled=!1)}l.addEventListener("click",()=>{Object.values(p).includes("")?Swal.fire({icon:"warning",title:"Error",text:"Debe seleccionar la nacionalidad e introducir la cedular del estudiante!"}):p.cedulaBusqueda===document.querySelector("#usuario-cedula").value?Swal.fire({icon:"warning",title:"Error",text:"AcciÃ³n no permitida!"}):async function(){const{cedulaBusqueda:e,nacionalidad:t}=p;l.disabled=!0;try{const o=`https://sigrece.uptbolivar.edu.ve/api/buscar-alumno?cedula=${e}&nacionalidad=${t}`,a=await fetch(o),i=await a.json();"error"===i.estatus?(Swal.fire({icon:"error",title:"Error",text:i.mensaje}),setTimeout(()=>{l.disabled=!1},3e3)):(h(i,t),setTimeout(()=>{l.disabled=!1},3e3))}catch(e){console.log(e)}}()}),s.addEventListener("change",m),c.addEventListener("input",m),d.addEventListener("change",e=>{if(u.style.display="none",f.dirigido=e.target.value.trim(),"terceros"===f.dirigido&&(s.disabled=!1),"propia"===f.dirigido){s.disabled=!0,r.style.display="none",c.value="",s.selectedIndex=0;!async function(e,t){const o=e,a=t;try{const e=`https://sigrece.uptbolivar.edu.ve/api/buscar-alumno?cedula=${o}&nacionalidad=${a}`,t=await fetch(e,{method:"GET"});h(await t.json(),a)}catch(e){console.log(e)}}(document.querySelector("#usuario-cedula").value,document.querySelector("#usuario-nacionalidad").value)}f.nombres=[],o.selectedIndex=0,v(),b(),function(){if(i.firstChild)for(;i.firstChild;)i.removeChild(i.firstChild)}()});const p={cedulaBusqueda:"",nacionalidad:""},f={usuario:t??"",categoria:"",nombres:[],precioTotal:"",dirigido:"",modelo:"",idModelo:""};function h(e,t){const{Pnf:o,apellidos:a,nombres:i,cedula:n,id:r,modelo:d}=e;u.style.display="grid";const c=document.querySelector("#nombres"),l=document.querySelector("#apellidos"),s=document.querySelector("#cedula"),m=document.querySelector("#pnf");c.value=i,l.value=a,s.value=`${t} - ${n}`,m.value=o,f.pnf=o,f.idModelo=r,f.modelo=d}function v(){if(n.firstChild)for(;n.firstChild;)n.removeChild(n.firstChild)}function b(){if(a.firstChild)for(;a.firstChild;)a.removeChild(a.firstChild)}o.addEventListener("change",t=>{const o=t.target.value.toLowerCase();v(),b(),i.firstChild&&i.removeChild(i.firstChild),f.nombres=[],async function(t){const o=new FormData;o.append("categoria",t),n.innerHTML='<div class="loader"></div>';try{const t=window.location.origin+"/api/aranceles",r=await fetch(t,{method:"POST",body:o}),d=await r.json();setTimeout(()=>{!function(t){const o=document.querySelector("#tasa-dia").textContent.trim();e=parseFloat(o),v(),t.aranceles.forEach(t=>{const{id:r,nombre:d,precio:c,tipo:l}=t,s="dolar"===l?(c*parseFloat(o)).toFixed(2):c,u=document.createElement("DIV");u.dataset.arancelId=r,u.classList.add("arancel"),u.onclick=function(){!function(t){const{categoria:o,id:n}=t,{nombres:r}=f,d=document.querySelector(`[data-arancel-id="${n}"]`);r.some(e=>e.id===n)?(f.nombres=r.filter(e=>e.id!==n),d.classList.remove("seleccionado")):(d.classList.add("seleccionado"),f.nombres=[...r,t],f.categoria=o);!function(t){b();let o="",n=0;t.forEach(t=>{const{nombre:i,precio:r,tipo:d}=t;o="dolar"===d?function(t){return parseFloat((t*e).toFixed(2))}(r):parseFloat(r),n+=o;const c=document.createElement("li");c.classList.add("lista-precio"),c.textContent=`${i} = ${o} Bs`,a.appendChild(c)}),f.precioTotal=n.toFixed(2);const r=document.createElement("LI");if(r.classList.add("precio-total"),r.textContent=`Total = ${n.toFixed(2)} Bs`,a.appendChild(r),Object.values(f).includes("")||0===f.nombres.length)return void(i.firstChild&&i.removeChild(i.firstChild));if(!i.firstChild){const e=document.createElement("BUTTON");e.classList.add("boton"),e.textContent="Enviar",e.onclick=()=>{Swal.fire({title:"NOTA!",text:"Una vez que realice su solicitud, tiene 24 horas para reportar su pago",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ok!",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&async function(){const{usuario:e,categoria:t,nombres:o,pnf:a,precioTotal:i,dirigido:n,modelo:r,idModelo:d}=f,c=o.map(e=>e.nombre),l=new FormData;l.append("usuario",e),l.append("categoria",t),l.append("pnf",a),l.append("aranceles",c),l.append("precioTotal",i),l.append("dirigido",n),l.append("modelo",r),l.append("idModelo",d);const s=document.querySelector(".boton");s.textContent="Enviando...",s.disabled=!0;try{const e=window.location.origin+"/api/solicitud",t=await fetch(e,{method:"POST",body:l});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Solicitud Enviado Correctamente!",button:"OK!"}).then(()=>{setTimeout(()=>{window.location.replace("/estudiante/solicitudes")},500)})}catch(e){console.log(e),Swal.fire({icon:"error",title:"Error",text:"Opps, Ha ocurrido un error, vuelva a intentarlo!"}),s.disabled=!1,s.textContent="Enviar"}}()})},i.appendChild(e)}}(f.nombres)}(t)};const m=document.createElement("P");m.classList.add("nombre-arancel"),m.textContent=`${d} ${s} Bs`,u.appendChild(m),n.appendChild(u)})}(d)},2e3)}catch(e){console.log(e)}}(o)})}();